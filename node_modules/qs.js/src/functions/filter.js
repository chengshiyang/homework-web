import {createStreamConstructor, createPropertyConstructor} from './common';



const mixin = {
    init({fn}) {
        this._fn = fn;
    },

    _free() {
        this._fn = null;
    },

    _handleValue(x) {
        if (this._fn(x)) {
            this.emitValue(x);
        }
    }

};


const FilterStream = createStreamConstructor('filter', mixin);
const FilterProperty = createPropertyConstructor('filter', mixin);


function filter(source, fn) {
    return new (source._ofSameType(FilterStream, FilterProperty))(source, {fn});
}



export default filter;