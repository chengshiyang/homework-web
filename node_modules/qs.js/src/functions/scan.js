import {createPropertyConstructor} from './common';
import {M_NULL} from '../constants/common';


const mixin = {
    init({fn, seed}) {
        this._fn = fn;
        this._seed = seed;
        if (seed !== M_NULL) {
            this.emitValue(seed);
        }
    },

    _free() {
        this._seed = null;
        this._fn = null;
    },

    _handleValue(val) {
        const fn = this._fn;
        if (this._currentEvent !== null) {
            this.emitValue(fn(this._currentEvent.value, val));
        } else {
            this.emitValue(this._seed === M_NULL ? val : fn(this._seed, val));
        }
    }
};

const S = createPropertyConstructor('scan', mixin);


function scan(source, fn, seed = M_NULL) {
    return new S(source, {fn, seed});
}



export default scan;
