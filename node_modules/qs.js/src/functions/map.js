import {createStreamConstructor, createPropertyConstructor} from './common';



const mixin = {
    init({fn}) {
        if (typeof fn !== 'function') {
            //处理 .map(1) 的情形， 这种调用方式表示  fn = () => 1
            this._fn = () => fn;
        } else {
            this._fn = fn;
        }
    },

    _free() {
        this._fn = null;
    },

    _handleValue(x) {
        this.emitValue(this._fn(x));
    }
};

const MapStream = createStreamConstructor('map', mixin);
const MapProperty = createPropertyConstructor('map', mixin);

function map(source, fn) {
    return new (source._ofSameType(MapStream, MapProperty))(source, {fn});
}



export default map;